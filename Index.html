<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Aâ€“Z of Us â€” Romantic Countdown</title>
  <style>
    /* ===== Romantic theme: soft pinks, glow, handwritten accents ===== */
    :root {
      --bg: #1a0000;
      --card: #2a0000;
      --accent: #8B0000;
      --accent-2: #b30000;
      --muted: #cfa3a3;
      --glass: rgba(43, 0, 0, 0.6);
      --shadow: 0 8px 24px rgba(139, 0, 0, 0.25);
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Trebuchet MS', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    body {
      background: linear-gradient(180deg, #330000 0%, #1a0000 100%);
      color: #f4dcdc; /* light rose text for contrast */
      -webkit-font-smoothing: antialiased;
      padding:24px;
      display:flex;
      justify-content:center;
      align-items:flex-start;
      gap:20px;
      overflow-x:hidden;
    }

    .container{max-width:1100px;width:100%;}
    header{display:flex;align-items:center;gap:16px;margin-bottom:22px;}
    .logo{
      width:84px;height:84px;border-radius:18px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
      box-shadow: 0 6px 18px rgba(255,111,163,0.16);
      display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:32px;
      transform:rotate(-8deg);
    }
    h1{margin:0;font-size:22px;line-height:1.1;}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:14px;}

    .top-row{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:18px;}
    .left { display:flex;flex-direction:column; }

    .countdown{ display:flex;gap:8px;align-items:center;margin-top:10px;
      background:var(--glass);padding:10px;border-radius:12px;box-shadow:var(--shadow);
    }
    .countdown .item{min-width:64px;text-align:center;}
    .countdown .num{font-size:18px;font-weight:700;color:var(--accent);}

    /* Grid of letters */
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:12px;margin-top:16px;}
    .card{
      background:var(--card);border-radius:12px;padding:12px;box-shadow:var(--shadow);min-height:110px;
      display:flex;flex-direction:column;justify-content:space-between;position:relative;overflow:hidden;
    }
    .letter{font-size:28px;font-weight:800;color:var(--accent);letter-spacing:1px;}
    .title{font-size:13px;margin-top:6px;color:#6a4656}
    .locked {
      position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,255,255,0.5),rgba(255,255,255,0.65));
      display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:#a86d84;
      backdrop-filter: blur(3px);
      text-align:center;
      padding:8px;
    }
    .unlocked-badge{
      position:absolute;right:10px;top:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));
      color:white;padding:6px 8px;border-radius:999px;font-size:12px;box-shadow:0 4px 12px rgba(179,0,0,0.35);
    }
    .open-btn{background:transparent;border:2px solid var(--accent);color:var(--accent);padding:8px;border-radius:10px;font-weight:700;cursor:pointer;}
    .open-btn:hover{background:var(--accent);color:white;transition:all .18s;}
    footer.small{margin-top:18px;color:var(--muted);font-size:13px}

    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(11,7,9,0.46);display:none;align-items:center;justify-content:center;z-index:60}
    .modal{background:linear-gradient(180deg,#fff 0%, #fff9fb 100%);padding:22px;border-radius:14px;max-width:720px;width:94%;box-shadow:0 20px 60px rgba(91,54,77,0.36);position:relative;}
    .modal h2{margin-top:0;color:var(--accent);}
    .close-btn{position:absolute;right:12px;top:8px;background:transparent;border:none;font-size:20px;cursor:pointer;color:#7b4f61}

    /* music player */
    .music{display:flex;align-items:center;gap:10px;background:var(--glass);padding:8px;border-radius:10px;}
    input[type="text"], input[type="password"]{padding:8px;border-radius:8px;border:1px solid #f0dbe1;background:white;}
    .admin {display:flex;gap:8px;align-items:center;}
    .hint{font-size:12px;color:#92626f;margin-top:8px;}
    #musicPlayerContainer{min-width:240px;min-height:56px}
    .spotify-iframe{border-radius:8px;overflow:hidden;border:0;width:300px;height:80px}
    .spotify-overlay{position:relative;display:flex;align-items:center;gap:8px}
    .spotify-click-to-play{background:rgba(0,0,0,0.5);color:white;padding:6px 10px;border-radius:8px;cursor:pointer;border:0}

    /* falling petals */
    .petal{position:fixed;top:-10vh;pointer-events:none;z-index:50;opacity:0.95;transform-origin:center;will-change:transform,opacity;}
    @keyframes fall {
      0%{transform: translateY(-10vh) rotate(0deg) translateX(0); opacity:1;} 
      90%{opacity:0.95;}
      100%{transform: translateY(110vh) rotate(360deg) translateX(30px); opacity:0;}
    }

    @media (max-width:640px){
      .grid{grid-template-columns:repeat(4,1fr)}
      header{flex-direction:row;gap:12px}
      .spotify-iframe{width:220px;height:70px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">Aâ€“Z</div>
      <div>
        <h1>The Aâ€“Z of Us â€” 26 little virtual dates</h1>
        <p class="lead" id="welcome-msg">Welcome to The Aâ€“Z of Us â€” 26 little adventures leading up to your special day ğŸ’•</p>
        <div class="countdown" style="margin-top:10px;">
          <div class="item"><div style="font-size:12px;color:#7b4f61">Days to Nov 17</div><div class="num" id="daysTo">â€”</div></div>
          <div class="item"><div style="font-size:12px;color:#7b4f61">Today</div><div class="num" id="todayStr">â€”</div></div>
        </div>
      </div>
    </header>

    <div class="top-row">
      <div class="music" title="Music">
        <button id="playBtn">â–¶ Play music</button>
        <div id="musicPlayerContainer">
          <div id="trackName" style="font-size:13px;color:#6a4656">No track loaded â€” paste an MP3 or Spotify link in Settings</div>
        </div>
      </div>

      <div style="display:flex;align-items:center;gap:10px;">
        <div class="admin">
          <input id="adminPass" type="password" placeholder="Admin pass"/>
          <button id="unlockAll" class="open-btn">Unlock</button>
        </div>
      </div>
    </div>

    <main>
      <div style="display:flex;gap:14px;align-items:flex-start;">
        <section style="flex:1;">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <h3 style="margin:0;color:#6a4656">Letters</h3>
            <div style="font-size:13px;color:var(--muted)">Auto-unlock by date â€¢ Manual unlock available</div>
          </div>

          <div class="grid" id="lettersGrid">
            <!-- JS will populate letters here -->
          </div>

          <div class="hint">Tip: edit the <code>CONFIG</code> block at the top of this file to change dates, text, images, or the admin password.</div>
        </section>

        <aside style="width:320px;">
          <div style="background:var(--card);border-radius:12px;padding:14px;box-shadow:var(--shadow);">
            <h4 style="margin:0;color:var(--accent)">Settings</h4>
            <div style="margin-top:10px;">
              <label style="font-size:13px;color:var(--muted)">Welcome message</label><br/>
              <input id="welcomeInput" type="text" style="width:100%;" />
            </div>
            <div style="margin-top:10px;">
              <label style="font-size:13px;color:var(--muted)">Music URL (mp3 or Spotify link)</label><br/>
              <input id="musicInput" type="text" style="width:100%;" placeholder="https://open.spotify.com/track/... or https://.../file.mp3" />
            </div>
            <div style="margin-top:10px;display:flex;gap:8px;">
              <button id="saveSettings" class="open-btn">Save</button>
              <button id="generateWeekends" class="open-btn" style="background:transparent;color:var(--accent)">Weekend schedule</button>
            </div>
            <div style="margin-top:10px;font-size:12px;color:var(--muted)">
              <strong>Start date:</strong> <span id="startDateText"></span><br/>
              <strong>End date:</strong> Nov 17 (birthday) ğŸ’
            </div>
          </div>

          <div style="height:12px;"></div>

          <div style="background:linear-gradient(90deg,var(--accent-2),#fff);padding:12px;border-radius:12px;box-shadow:var(--shadow);">
            <strong style="color:#6a4656">Admin</strong>
            <div style="margin-top:8px;font-size:13px;color:var(--muted)">Enter the admin password above (default in config) then click Unlock to manually reveal locked letters.</div>
          </div>
        </aside>
      </div>
    </main>

    <footer class="small">Made with â¤ï¸ â€” Your Girlfriend</footer>
  </div>

  <!-- Modal for letter content -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="close-btn" id="closeModal">âœ•</button>
      <h2 id="modalLetter">A â€” Art Night</h2>
      <div id="modalContent" style="color:#6a4656"></div>
      <div style="margin-top:12px;">
        <button id="modalAction" class="open-btn">Do the thing</button>
      </div>
    </div>
  </div>

  <audio id="bgAudio" preload="none"></audio>

  <script>
  /* ==========================
     CONFIG â€” customize here
     ========================== */
  const CONFIG = {
    startDate: "2025-10-22", // first letter date (YYYY-MM-DD)
    birthdayDate: "2025-11-17",
    welcomeMessage: "Welcome to The Aâ€“Z of Us â€” 26 little adventures leading up to your special day ğŸ’•",
    adminPassword: "Kellsin", // change this to something private
    autoAssignSequential: true, // if true: letters will be assigned starting at startDate sequentially (one per day)
    useWeekendSchedule: false, // if true, you can generate weekend-only dates with the helper button
    // Optional default music (empty to start without)
    musicUrl: "https://raw.githubusercontent.com/Tosin2513/Kellies-Birthday-/main/aya.mp3", // put an MP3 link or Spotify link here if you want (or paste in Settings later)
    // Editable items for Aâ€“Z:
    items: [
      { letter: "A", title: "A message from me", text: "Hey baby â€” I just wanted to start this Aâ€“Z journey by reminding you how much I love you.<br/><br/><a href=\"https://drive.google.com/file/d/1YQq4AI71qItfsO0qwPld98S7ux83hY4X/view?usp=drivesdk\" target=\"_blank\" rel=\"noopener\">Open the surprise (Drive)</a>" },
      { letter: "B", title: "Because of you", text: "Because of you, I smile more and love deeper.<br/><br/><a href=\"https://drive.google.com/file/d/1Bj289zT4NsBNBKBgYPGL1lWSL1xBfFd_/view?usp=drivesdk\" target=\"_blank\" rel=\"noopener\">Open the surprise (Drive)</a>"  },
      { letter: "C", title: "Compliment Jar", text: `
    You deserve to be reminded how amazing you are. Click below! ğŸ’•
    <br/><br/>
    <button onclick="showCompliment()" style="
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    ">
      Pick a compliment ğŸ’Œ if you dareeeğŸ˜ğŸ˜ (7 comps)
    </button>
    <p id="complimentText" style="margin-top:10px;color:var(--muted);font-size:1rem;"></p>
  `,
},
      { letter: "D",
  title: "Do Not Disturb",
  text: `
    Pick a date and time â€” no multitasking ğŸ«µ let's have a deep conversation we haven't had in a while.
    <br/><br/>
    <a href="https://wa.me/2348157173008?text=Hey%20love%20ğŸ’•%20I'm%20ready%20for%20our%20crazy%20talk!"
       target="_blank"
       style="background:#8B0000;color:#fff;padding:10px 16px;border-radius:25px;text-decoration:none;font-weight:600;">
       ğŸ’¬ Message me on WhatsApp
    </a>
  `,
  media: ""
},
    {
  letter: "E",
  title: "E â€“ Everything For You",
  text: `
    <style>
      .letter-container {
        background: rgba(255,255,255,0.05);
        border-radius: 14px;
        padding: 15px;
        color: #f3dcdc;
        line-height: 1.6;
        overflow: hidden;
        max-width: 600px;
        margin: auto;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        animation: openLetter 1.2s ease forwards;
        transform-origin: top;
      }
      @keyframes openLetter {
        from { transform: rotateX(-90deg); opacity: 0; }
        to { transform: rotateX(0); opacity: 1; }
      }
    </style>

    <div class="letter-container">
      <p>
        Hey baby, ğŸ’•<br/><br/>
        So the first few dates were visual â€” you saw my beautiful face ğŸ¤­, laughed and cried too.  
        Let's carry on. We have a long way to go, don't you think? ğŸ’«
      </p>
      <p>
        I'm doing this because I love you. I know I don't always say it or type it, but I do.  
        I say some shit sometimes ğŸ˜“, short tempered and always itching for a fight â€”  
        but you're always there. I wonder why sha ğŸ˜… but the fact that you're still here  
        means I'm doing something right, and I always want to appreciate you  
        any and every way I can. â¤ï¸
      </p>
      <p>
        I love you, Kellie.  
        <br/><br/>
        You wouldâ€™ve loved this in my voice, wouldnâ€™t you? ğŸ˜ğŸ˜ğŸ˜
      </p>
    </div>
  `,
  media: ""
},
      { 
  letter: "F",
  title: "Food Date ğŸ³",
  text: `
    Todayâ€™s theme? FOOD ğŸ˜‹  
    <br/><br/>
    From breakfast to dinner, weâ€™re eating *together* â€” different meals, different places.  
    Send me pics, voice notes, or even a video of your bites (Iâ€™ll do the same ğŸ˜).  
    <br/><br/>
    Whether itâ€™s pancakes, noodles, or nothing ğŸ˜­, itâ€™s our little food adventure for the day.  
    <br/><br/>
    Letâ€™s make it special and cute â€” no skipping meals, chef Kellie. Find me on WhatsApp ğŸ˜ğŸ’•ğŸ´
  `,
  media: ""
},
      {
  letter: "G",
  title: "Game Night ğŸ¨",
  text: `
    Tonight, it's game time! ğŸ˜<br/><br/>
    We're heading to <strong>skribbl.io</strong> for a fun little drawing challenge â€”
    no cheating, no laughing at my masterpieces (okay maybe a little ğŸ˜‚ cause I go laugh youuu).<br/><br/>
    <a href="https://skribbl.io/?sUCNiCKA" target="_blank"
      style="display:inline-block;background:var(--accent);color:white;padding:10px 16px;border-radius:8px;text-decoration:none;font-weight:600;box-shadow:0 4px 10px rgba(0,0,0,0.3);">
      ğŸ® Join Our Game
    </a><br/><br/>
    Loser owes the winner... one voice note saying <em>â€œyouâ€™re the bestttt marry me and draw a portrait!â€</em> ğŸ˜˜
  `,
  media: ""
},
      { 
  letter: "H",
  title: "H is for Hamilton ğŸ­",
  text: `
    Tonightâ€™s your <strong>first Hamilton</strong> watch ğŸ˜<br/><br/>
    Itâ€™s my favorite â€” and sharing it with you makes it even better.  
    Get cozy, grab snacks ğŸ¿, and letâ€™s make it a date. ğŸ’•<br/><br/>
    <a href="https://wa.me/2348157173008?text=Let's%20watch%20Hamilton%20ğŸ’" target="_blank"
      style="display:inline-block;background:var(--accent);color:white;padding:10px 14px;border-radius:8px;text-decoration:none;font-weight:600;">
      ğŸ¶ Letâ€™s Watch Together
    </a>
  `,
  media: ""
},
      {
  letter: "I",
  title: "I Want to Know Who You Know Better ğŸ’",
  text: `
    I want to know who you know better â€” me, Mamamoo, or Hua Cheng ğŸ˜—<br/>
    If it's not me... you owe me â‚¦500k ğŸ˜ŒğŸ’¸<br/><br/>
    <a href="https://imquiz.co/?id=C6QtrB" target="_blank" 
      style="display:inline-block;margin:6px 0;padding:10px 14px;background:var(--accent);
             color:white;border-radius:10px;text-decoration:none;font-weight:600;">
      ğŸ’– How Well Do You Know Me?
    </a><br/>
    <a href="https://opinionstage.com/page/69c4da6a-b245-4840-8159-7dbbb34032e0" target="_blank"
      style="display:inline-block;margin:6px 0;padding:10px 14px;background:var(--accent);
             color:white;border-radius:10px;text-decoration:none;font-weight:600;">
      ğŸ¤ MAMAMOO Quiz
    </a><br/>
    <a href="https://opinionstage.com/page/d8a4c58f-3a12-4559-87a2-0974e2b30fc4" target="_blank"
      style="display:inline-block;margin:6px 0;padding:10px 14px;background:var(--accent);
             color:white;border-radius:10px;text-decoration:none;font-weight:600;">
      ğŸ¦‹ Hua Cheng Quiz
    </a>
  `,
  media: ""
},
      { 
  letter: "J",
  title: "Just Us",
  text: `
    Let's have a mini date on WhatsApp ğŸ’Œ<br/><br/>
    <a href="https://wa.me/2348157173008" target="_blank"
       style="display:inline-block;padding:10px 18px;border-radius:8px;
       background:var(--accent);color:#fff;text-decoration:none;font-weight:600;">
       Message Me â¤ï¸
    </a>
  `,
  media: ""
      },
      {
  letter: "K",
  title: "Kodak Moments ğŸ“¸",
  text: `
    Todayâ€™s challenge: our <strong>Kodak Day!</strong> ğŸ©¶<br/><br/>
    Take pictures of <em>everything</em> â€” food, your cute face, random things that make you smile.  
    Weâ€™re calling it <b>A Day in the Life of Kellie</b> ğŸ“·ğŸ’‹<br/><br/>
     Send them to me on WhatsApp  ğŸ˜Œ
    <br/><br/>
    <a href="https://wa.me/08157173008?text=Here%20are%20my%20Kodak%20Moments%20for%20you%20ğŸ’‹" 
       target="_blank"
       style="display:inline-block;
              background:linear-gradient(90deg,var(--accent),var(--accent-2));
              color:#fff;
              padding:10px 16px;
              border-radius:10px;
              text-decoration:none;
              font-weight:600;
              box-shadow:0 3px 10px rgba(0,0,0,0.2);">
       Send Pictures ğŸ’Œ
    </a>
  `,
  media: ""
},
      {
  letter: "L",
  title: "Letter to the Future ğŸ’Œ",
  text: `
    Hey baby, todayâ€™s about us â€” one year from now.  
    Write a letter to Future You (and Iâ€™ll write mine too).  
    Letâ€™s talk about where weâ€™ll be, what weâ€™ll be doing, and everything we hope for.  
    Weâ€™ll open them together next year â¤ï¸  
    <br/><br/>
    <a href="https://www.futureme.org/letters/new?ukey=Up6bl1dREc1aM0nwoaSqIiGrv0nFKj&utm_campaign=fm-send&utm_content=write&utm_medium=email&utm_source=fm-delivery"
       target="_blank"
       style="background:var(--accent);
              color:#fff;
              padding:10px 16px;
              border-radius:10px;
              text-decoration:none;
              font-weight:600;
              box-shadow:0 2px 8px rgba(0,0,0,0.2);">
       Write your letter ğŸ’•
    </a>
  `,
  media: ""
},
      {
  letter: "M",
  title: "Mystery Challenge ğŸ”¥",
  text: `
    Tonightâ€™s mission... should you choose to accept it ğŸ˜ˆ<br/><br/>
    Itâ€™s time for a little <b>Love & Lust Mystery Challenge</b> â€” only for us two.  
    <br/><br/>
    Click below to start the game ğŸ‘€ and see what happens next.
    <br/><br/>
    <a href="https://www.pilipi.li/products/love-lust-spicy-card-game" target="_blank" 
      style="display:inline-block;padding:10px 18px;background:linear-gradient(90deg,#8B0000,#ff4d4d);
             color:#fff;border-radius:10px;text-decoration:none;font-weight:bold;">
      Start the Challenge â¤ï¸â€ğŸ”¥
    </a>
  `,
  media: ""
},
      {
  letter: "N",
  title: "Night Message",
  text: `
    I didnâ€™t want to type tonight â€” I wanted you to <b>hear</b> me. ğŸ¥ºğŸ’<br/><br/>
    So hereâ€™s a little something from me to you.<br/><br/>
    <video controls style="width:100%;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.2);">
      <source src="https://drive.google.com/uc?export=download&id=YOUR_VIDEO_ID" type="video/mp4">
    </video>
    <br/><br/>
    Just a reminder that I love you  always. ğŸ˜ŒğŸ’—
  `,
  media: ""
      },
      { letter: "O",
  title: "Origami Time âœ‚ï¸",
  text: `
    Okayyy so O is for <b>Origami</b> ğŸ¤­ğŸ¤­  
    You make, I watch â€” or maybe we both make it together ğŸ¥¹ğŸ’  
    Itâ€™s meant to be simple and fun sha ğŸ˜­  
    <br/><br/>
    <iframe width="100%" height="215" style="border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.3);" 
      src="https://www.youtube.com/embed/l8Lc5N_Wwaw?si=yNoDR7oGkkJBxD4w" 
      title="Origami video" frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen></iframe>
  `,
  media: ""
},
      { letter: "P", title: "Puzzle Date", text: "A custom crossword/quiz about us." },
      { letter: "Q", title: "Q&A", text: "10 deep questions â€” answer one per call and we'll learn more about each other." },
      { letter: "R", title: "Recipe Swap", text: "We each cook one dish on video and enjoy together â€” bonus if we pick the same recipe!" },
      { letter: "S", title: "Song Dedication", text: "I recorded a small dedication â€” press play to hear it." },
      { letter: "T", title: "Throwback", text: "Old screenshots, texts, and photos â€” a timeline of our best moments." },
      { letter: "U", title: "Unplugged", text: "A long, phone-free call: just voice, stories, and time for us." },
      { letter: "V", title: "Virtual Trip", text: "Let's wander a new city together using Google Maps and plan an itinerary." },
      { letter: "W", title: "Wishlist", text: "A shared list of future adventures to add to over coffee and laughs." },
      { letter: "X", title: "eXtra Love", text: "A small surprise: a short poem and a digital card. â¤ï¸" },
      { letter: "Y", title: "Year in Review", text: "Highlights from this past year together â€” photos + silly captions." },
      { letter: "Z", title: "Zest for Us", text: "Happy birthday! A final video montage and a message from me to you." }
    ]
  };

  /* END CONFIG */
  /* ========================== */

  // ---------- Utilities ----------
  const $ = sel => document.querySelector(sel);
  const daysBetween = (a,b) => Math.floor((b - a) / (1000*60*60*24));

  // Use a local ISO date (YYYY-MM-DD) built from local date components to avoid timezone shifts
  const localISO = d => {
    if(!(d instanceof Date)) d = new Date(d);
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const day = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  };

  // Parse dates
  const START = new Date(CONFIG.startDate + "T00:00:00");
  const BDAY = new Date(CONFIG.birthdayDate + "T00:00:00");

  // If autoAssignSequential, fill dates from startDate onward (one per day).
  function assignSequentialDates(items, startDate){
    let d = new Date(startDate);
    for(let i=0;i<items.length;i++){
      items[i].date = localISO(d);
      d.setDate(d.getDate() + 1);
    }
  }

  // Helper: generate weekend-only dates between start and birthday and map letters to them
  function generateWeekendSchedule(items, startDate, endDate){
    const weekends = [];
    const cur = new Date(startDate);
    const end = new Date(endDate);
    while(cur <= end){
      const day = cur.getDay(); // 0=Sun,6=Sat
      if(day === 0 || day === 6) weekends.push(localISO(cur));
      cur.setDate(cur.getDate()+1);
    }
    // If there are fewer weekend days than items, fallback to sequential assignment
    if(weekends.length < items.length){
      assignSequentialDates(items, startDate);
      return false;
    }
    for(let i=0;i<items.length;i++){
      items[i].date = weekends[i];
    }
    return true;
  }

  // Initialize schedule
  if(CONFIG.autoAssignSequential){
    assignSequentialDates(CONFIG.items, START);
  }

  // DOM references
  const lettersGrid = $("#lettersGrid");
  const daysToEl = $("#daysTo");
  const todayStrEl = $("#todayStr");
  const welcomeMsgEl = $("#welcome-msg");
  const welcomeInput = $("#welcomeInput");
  const startDateText = $("#startDateText");
  const musicInput = $("#musicInput");
  const trackName = $("#trackName");
  const bgAudio = $("#bgAudio");
  const playBtn = $("#playBtn");
  const adminPassInput = $("#adminPass");
  const unlockAllBtn = $("#unlockAll");
  const saveSettingsBtn = $("#saveSettings");
  const generateWeekendsBtn = $("#generateWeekends");
  const musicPlayerContainer = $("#musicPlayerContainer");
  const modalBackdrop = $("#modalBackdrop");
  const modalLetter = $("#modalLetter");
  const modalContent = $("#modalContent");
  const modalAction = $("#modalAction");
  const closeModalBtn = $("#closeModal");

  // Show start date
  startDateText.textContent = CONFIG.startDate;

  // Load initial welcome & music
  welcomeMsgEl.textContent = CONFIG.welcomeMessage;
  welcomeInput.value = CONFIG.welcomeMessage;
  musicInput.value = CONFIG.musicUrl || "";

  // Helpers for Spotify detection and embed URL
  function parseSpotifyUrl(url){
    try{
      const u = new URL(url);
      // open.spotify.com links
      if(u.hostname.includes("spotify.com") || u.hostname.includes("open.spotify.com")){
        const parts = u.pathname.split('/').filter(Boolean); // e.g. ["track","<id>"]
        if(parts.length >= 2){
          return {host:"spotify", type:parts[0], id:parts[1]};
        }
      }
      // spotify:track:... uri
      if(url.startsWith("spotify:")){ 
        const p = url.split(':');
        if(p.length >= 3) return {host:"spotify", type:p[1], id:p[2]};
      }
    }catch(e){}
    return null;
  }

  function spotifyEmbedUrl(parsed){
    if(!parsed) return null;
    return `https://open.spotify.com/embed/${parsed.type}/${parsed.id}`;
  }

  // Clear music UI
  function clearMusicUI(){
    musicPlayerContainer.innerHTML = '';
    bgAudio.pause();
    bgAudio.removeAttribute('src');
    playBtn.textContent = "â–¶ Play";
  }

  // Load music: supports MP3 direct links and Spotify links (embed)
  // autoplayRequested: boolean (try to autoplay on load; may be blocked by browser for cross-origin embeds)
  function loadMusic(url, autoplayRequested = false){
    clearMusicUI();
    const trimmed = (url || "").trim();
    if(!trimmed){
      trackName.textContent = "No track loaded â€” paste an MP3 or Spotify link in Settings";
      return;
    }

    // MP3 handling (native audio element; autoplay more reliable)
    if(/\.(mp3)(\?.*)?$/i.test(trimmed)){ 
      bgAudio.src = trimmed;
      trackName.textContent = trimmed.split('/').pop();
      // attach simple play/pause
      playBtn.onclick = () => {
        if(bgAudio.paused){
          bgAudio.play().catch(()=> alert("Autoplay prevented â€” interact with the page then press Play."));
          playBtn.textContent = "â¸ Pause";
        } else {
          bgAudio.pause();
          playBtn.textContent = "â–¶ Play";
        }
      };
      if(autoplayRequested){
        // try to autoplay
        bgAudio.play().then(()=> { playBtn.textContent = "â¸ Pause"; }).catch(()=> {
          // failed - wait for user interaction
          playBtn.textContent = "â–¶ Play";
          document.addEventListener("click", function once(){ bgAudio.play().then(()=>{ playBtn.textContent="â¸ Pause"; }).catch(()=>{}); document.removeEventListener("click", once); });
        });
      }
      return;
    }

    // Spotify handling
    const parsed = parseSpotifyUrl(trimmed);
    if(parsed){
      const embedSrc = spotifyEmbedUrl(parsed);
      // create iframe
      const iframe = document.createElement("iframe");
      iframe.className = "spotify-iframe";
      // Append autoplay hint param â€” browsers will often block autoplay for cross-origin iframes.
      iframe.src = embedSrc + (autoplayRequested ? "?utm_source=generator&autoplay=1" : "?utm_source=generator");
      iframe.width = "300";
      iframe.height = "80";
      iframe.allow = "autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture";
      iframe.frameBorder = "0";
      musicPlayerContainer.appendChild(iframe);

      // show track name if possible (we only have type/id)
      trackName.textContent = `${parsed.type} â€¢ ${parsed.id}`;

      // Play button behavior: when clicked, focus iframe (user gesture) to enable playback in many browsers
      playBtn.onclick = () => {
        try{
          iframe.contentWindow && iframe.contentWindow.focus && iframe.contentWindow.focus();
        }catch(e){}
        const directUrl = `https://open.spotify.com/${parsed.type}/${parsed.id}`;
        const opened = window.open(directUrl, "_blank");
        if(opened) opened.focus();
      };

      // If autoplay was requested, attempt to nudge playback: browsers will likely block, so we show a click prompt
      if(autoplayRequested){
        const prompt = document.createElement("div");
        prompt.className = "spotify-overlay";
        prompt.innerHTML = `<button class="spotify-click-to-play">Tap to play Spotify</button><span style="font-size:12px;color:var(--muted);margin-left:8px">Autoplay may be blocked â€” click to open Spotify</span>`;
        musicPlayerContainer.appendChild(prompt);
        const btn = prompt.querySelector(".spotify-click-to-play");
        btn.onclick = () => {
          window.open(`https://open.spotify.com/${parsed.type}/${parsed.id}`, "_blank");
        };
      }
      return;
    }

    // Fallback: not an MP3 or recognized Spotify link
    trackName.textContent = "Unsupported music link â€” use MP3 or Spotify track URL";
  }

  // ---------- UI: letters rendering, modal, settings ----------
  function todayISO(){
    return localISO(new Date());
  }

  function isUnlocked(itemDate){
    // unlocked if the date is today or in the past (compare local YYYY-MM-DD strings to avoid TZ issues)
    if(!itemDate) return false;
    try{
      const today = todayISO();
      return itemDate <= today;
    }catch(e){
      return false;
    }
  }

  function renderLetters(){
    lettersGrid.innerHTML = '';
    CONFIG.items.forEach((it, idx) => {
      const card = document.createElement('div');
      card.className = 'card';
      const letterEl = document.createElement('div');
      letterEl.className = 'letter';
      letterEl.textContent = it.letter;
      const titleEl = document.createElement('div');
      titleEl.className = 'title';
      titleEl.textContent = it.title;
      const dateEl = document.createElement('div');
      dateEl.style.fontSize = '12px';
      dateEl.style.color = '#7b4f61';
      dateEl.textContent = it.date || 'â€”';

      card.appendChild(letterEl);
      card.appendChild(titleEl);
      card.appendChild(dateEl);

      if(isUnlocked(it.date)){ 
        const badge = document.createElement('div');
        badge.className = 'unlocked-badge';
        badge.textContent = 'Open';
        card.appendChild(badge);
      } else {
        const lock = document.createElement('div');
        lock.className = 'locked';
        lock.textContent = `Locked until ${it.date || 'â€”'}`;
        card.appendChild(lock);
      }

      card.style.cursor = 'pointer';
      card.onclick = () => {
        if(!isUnlocked(it.date)){ 
          alert(`This letter unlocks on ${it.date}.`);
          return;
        }
        openModal(it);
      };

      lettersGrid.appendChild(card);
    });
  }

  function openModal(item){
    modalLetter.textContent = `${item.letter} â€” ${item.title}`;
    // allow the text to contain small HTML (links, line breaks). Use innerHTML intentionally for the configured content.
    modalContent.innerHTML = item.text || '';
    modalAction.onclick = () => {
      // default action: show text â€” allow HTML to be visible already
      if(item.text) {
        // if there's a link, prefer opening it
        const linkMatch = String(item.text).match(/https?:\/\/[^\s'\"]+/);
        if(linkMatch){
          window.open(linkMatch[0], "_blank", "noopener");
          return;
        }
        alert(item.title || "No action provided.");
        return;
      }
      alert(item.title || "No action provided.");
    };
    modalBackdrop.style.display = 'flex';
  }

  closeModalBtn.onclick = () => { modalBackdrop.style.display = 'none'; };

  // Unlock all (admin)
  unlockAllBtn.onclick = () => {
    const attempt = adminPassInput.value;
    if(attempt === CONFIG.adminPassword){
      CONFIG.items.forEach(it => it.date = todayISO());
      renderLetters();
      alert('All letters unlocked.');
    } else {
      alert('Incorrect admin password.');
    }
  };

  // Save settings
  saveSettingsBtn.onclick = () => {
    CONFIG.welcomeMessage = welcomeInput.value || CONFIG.welcomeMessage;
    welcomeMsgEl.textContent = CONFIG.welcomeMessage;
    CONFIG.musicUrl = (musicInput.value || '').trim();
    loadMusic(CONFIG.musicUrl, false);
    alert('Settings saved (in-memory only).');
  };

  // Generate weekend schedule
  generateWeekendsBtn.onclick = () => {
    const ok = generateWeekendSchedule(CONFIG.items, CONFIG.startDate, CONFIG.birthdayDate);
    if(!ok){
      alert('Not enough weekend days between start and birthday â€” fell back to sequential assignment.');
    } else {
      alert('Weekend schedule generated.');
    }
    renderLetters();
  };

  // Countdown & Today display
  function updateCountdown(){
    const now = new Date();
    const days = daysBetween(now, BDAY);
    daysToEl.textContent = days >= 0 ? days : 'â€”';
    todayStrEl.textContent = now.toLocaleDateString();
  }

  // ---------- Petals: spawn and animate ----------
  function createPetal(){
    const petal = document.createElement('div');
    petal.className = 'petal';
    const size = Math.floor(Math.random() * 18) + 10; // 10-28px
    const left = Math.random() * 100; // vw
    const duration = (Math.random() * 8) + 8; // 8-16s
    const delay = Math.random() * 6; // 0-6s
    const rotate = Math.floor(Math.random() * 360);
    // blood-red colours for petals
    // style petal with a blood-red gradient and an oval shape
    petal.style.width = `${size}px`;
    petal.style.height = `${Math.floor(size * (0.7 + Math.random()*0.4))}px`;
    petal.style.left = `${left}vw`;
    petal.style.borderRadius = '50% 40% 40% 50% / 60% 60% 40% 40%';
    petal.style.background = `linear-gradient(135deg, #7b0000, #b30000)`;
    petal.style.transform = `rotate(${rotate}deg)`;
    petal.style.filter = `blur(${(Math.random()*1).toFixed(2)}px)`;
    petal.style.animation = `fall ${duration}s linear ${delay}s 1 forwards`;
    document.body.appendChild(petal);
    // remove after animation ends
    petal.addEventListener('animationend', () => {
      try{ petal.remove(); }catch(e){}
    });
  }

  function spawnPetals(count = 16){
    for(let i=0;i<count;i++){ 
      setTimeout(createPetal, Math.random()*1200);
    }
  }

  // Init
  renderLetters();
  updateCountdown();
  // try to load any configured music (autoplay not requested)
  if(CONFIG.musicUrl) loadMusic(CONFIG.musicUrl, false);

  // spawn some petals on load and keep sprinkling a few over time
  spawnPetals(24);
  setInterval(() => spawnPetals(3), 2500);

  // Update countdown every minute
  setInterval(updateCountdown, 60*1000);
// Autoplay the music after the first click (to bypass browser restrictions)
document.addEventListener("click", function once() {
  loadMusic(CONFIG.musicUrl, true);
  document.removeEventListener("click", once);
});
    
  </script>
  <!-- ğŸµ Music Play Button -->
<button id="musicButton" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #ff69b4;
  color: white;
  border: none;
  padding: 12px 18px;
  border-radius: 30px;
  font-size: 16px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  cursor: pointer;
  z-index: 9999;
">
  ğŸµ Tap to Play Music
</button>

<!-- ğŸ¶ Music Autoplay Script -->
<script>
document.getElementById("musicButton").addEventListener("click", function() {
  loadMusic(CONFIG.musicUrl, true);
  this.style.display = "none"; // Hides button after playing
});
  function showCompliment() {
  const compliments = [
    "You make everyday better by being unapologetically you â˜€ï¸",
    "You're a goat ğŸ¤£ yes yes compliments but even thennn âœ¨",
    "Youâ€™re <s>kind</s> not going around beating people, gorgeous (effortlessly, takes my breath away every time), and annoyingly lovable (with your cute nose) ğŸ˜ğŸ’–",
    "Everything's better with you around, you're like a light bulb of giddiness ğŸ’«",
    "You deserve everything and more. ğŸ“±â¤ï¸",
    "You're like an ang-, dem-, just Kellie. ğŸ±ğŸ˜—",
    "I love you so much, don't poop your pants okay? ğŸ˜‚"
  ];
  const random = compliments[Math.floor(Math.random() * compliments.length)];
  document.getElementById("complimentText").innerHTML = random;
  }
</script>
 
</body>
</html>
